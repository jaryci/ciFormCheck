/* ========================================================================
 * ciFormCheck: ciFormCheck.js v1.0.0
 * ========================================================================
 * Copyright 2018 classinstance.cn
 * ======================================================================== */
;(function(l){var n="fccheck fcname fcmsg fcrange fclength fcminlength fcmaxlength fcmaxlength fcscale fcsplit fcexpression".split(" ");l.fn.ciFormCheck=function(p){var m=this,k=l.extend({},{warringFlag:!1,warringClass:"csFormInput",onBlurCheck:!1,messageFunction:null,passFunction:null},p);this.settings=k;this.CheckClass=function(){var c=this;this.checkForm=function(){var a=!0;l(m).find("[fccheck]").each(function(b,d){var e=l(this);a=c.halderCheck(!0,e);if(0==a)return!1});return a};this.halderCheck=function(a,b){var d=b.attr("fccheck"),e=b.attr("fcname"),f=b.attr("fcmsg");c._selfAttrCheck(e,f);if(null!=d&&""!=d)if(e=d.split("\x26\x26"),d=c.doCheck(a,b,e[0]),2==e.length)if(e=c.doCheck(a,b,e[1]),d&&e)c._noWarring(b);else return c._warring(b),!1;else if(d)c._noWarring(b);else return c._warring(b),!1;return!0};this.doCheck=function(a,b,d){return"empty"==d&&1==a?c._checkEmpty(b):"radio"==b.attr("type")||"checkBox"==b.attr("type")||"SELECT"==b[0].tagName?(console.error("radio,checkBox,select support empty check only!"),!0):"int"==d?c._checkInt(b):"number"==d?c._checkNumber(b):"string"==d?c._checkString(b):"float"==d?c._checkFloat(b):"email"==d?c._checkEmail(b):"multiEmil"==d?c._checkMultiEmil(b):"regExp"==d?c._checkRegExp(b):!0};this._checkEmpty=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e="",e=a.attr("type"),f=a.attr("name"),g=!1;if("radio"==e){if(!f)return console.error("radio's name is undefined!"),!1;e=l("input[name\x3d'"+f+"']:checked").val();g=!0}else if("checkBox"==e){if(!f)return console.error("checkBox's name is undefined!"),!1;e=l("input[name\x3d'"+f+"']:checked").val();g=!0}else"SELECT"==a[0].tagName&&(g=!0),e=a.val();return""==e||void 0==e?(d&&""!=d?c._alert(d,a):0==g?c._alert(b+"\u4e0d\u80fd\u4e3a\u7a7a\uff01",a):c._alert("\u8bf7\u9009\u62e9"+b+"!",a),c._focus(a),!1):!0};this._checkInt=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.attr("fcrange"),f=a.val();if(null!=f&&0<f.length){if(isNaN(f)||-1!=f.indexOf(".")||-1!=f.indexOf(" "))return a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e,\u53ea\u80fd\u8f93\u5165\u6574\u6570\uff01",a),c._focus(a),!1;var f=parseInt(f),g="x\x3e\x3d0\x26\x26x\x3c\x3d999999999999",h="";e&&""!=e&&(g=e);for(h=g;-1!=h.indexOf("\x26\x26")||-1!=h.indexOf("||");)h=h.replace("\x26\x26","\u4e14").replace("||","\u6216\u8005");for(;-1!=g.indexOf("x");)g=g.replace("x",f);a.val(f);if(0==eval(g))return a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e,\u5fc5\u987b"+h+"\uff01",a),c._focus(a),!1}return!0};this._checkNumber=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.val();return null!=e&&0<e.length?isNaN(e)||-1!=e.indexOf(" ")?(a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e,\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01",a),c._focus(a),!1):c._checkLength(a):!0};this._checkString=function(a){var b=a.val();return null!=b&&0<b.length?c._checkLength(a):!0};this._checkFloat=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.attr("fcrange"),f=a.attr("fcscale"),g=a.val();if(null!=g&&0<g.length){if(isNaN(g)||-1!=g.indexOf(" "))return a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e,\u53ea\u80fd\u8f93\u5165\u6570\u5b57\uff01",a),c._focus(a),!1;var h=0;f&&""!=f&&(h=parseInt(f));g=parseFloat(g).toFixed(h);f="x\x3e\x3d0\x26\x26x\x3c\x3d999999999999";h="";e&&""!=e&&(f=e);for(h=f;-1!=h.indexOf("\x26\x26")||-1!=h.indexOf("||");)h=h.replace("\x26\x26","\u4e14").replace("||","\u6216\u8005");for(;-1!=f.indexOf("x");)f=f.replace("x",g);a.val(g);if(0==eval(f))return a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e,\u5fc5\u987b"+h+"\uff01",a),c._focus(a),!1;a.val(g)}return!0};this._checkEmail=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.val();return null!=e&&0<e.length&&!/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(e)?(a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01",a),c._focus(a),!1):!0};this._checkMultiEmil=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.attr("fcsplit");e&&""!=e||(e=",");var f=a.val();if(null!=f&&0<f.length){var e=f.split(e),g;for(g in e)if(!/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(e[g]))return a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01",a),c._focus(a),!1}return!0};this._checkRegExp=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.attr("fcexpression");if(!e||""==e)return alert(b+"Regular check lack 'fcexpression' attribute\uff01"),!1;var f=a.val();return null!=f&&0<f.length&&!(new RegExp(e)).test(f)?(a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u683c\u5f0f\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01",a),c._focus(a),!1):!0};this._checkLength=function(a){var b=a.attr("fcname"),d=a.attr("fcmsg"),e=a.attr("fclength"),f=a.attr("fcminlength"),g=a.attr("fcmaxlength"),h=a.val().length,k=!0,l="",m="",n="";e&&""!=e&&h!=parseInt(e)&&(k=!1,l="\u5fc5\u987b\u662f"+e);f&&""!=f&&(h<parseInt(f)&&(k=!1),m="\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e"+f);g&&""!=g&&(h>parseInt(g)&&(k=!1),n=""!=m?"\u4e14\u5fc5\u987b\u5c0f\u4e8e\u7b49\u4e8e"+g:"\u5fc5\u987b\u5c0f\u4e8e\u7b49\u4e8e"+g);return 0==k?(a.val(""),d&&""!=d?c._alert(d,a):c._alert(b+"\u7684\u957f\u5ea6"+l+m+n+"!",a),c._focus(a),!1):!0};this._initClass=function(){if("csFormInput"==k.warringClass){var a=document.getElementsByTagName("HEAD").item(0),b=document.createElement("style");l(b).html(".csFormInput{border:1px solid red;}");a.appendChild(b)}};this._selfAttrCheck=function(a,b){a||b||console.error("The attribute 'fcname' and 'fcmsg' must set one!")};this._warring=function(a){k.warringFlag&&(a.attr("type"),a.addClass(k.warringClass))};this._noWarring=function(a){var b=a.val();k.warringFlag&&b&&a.removeClass(k.warringClass);k.passFunction&&b&&k.passFunction(a)};this._alert=function(a,b){k.messageFunction?k.messageFunction(a,b):alert(a)};this._focus=function(a){window.setTimeout(function(){a.focus()},0)}};this.checkForm=function(){return(new m.CheckClass).checkForm()};this.removeCheck=function(c){c.each(function(){for(var a in n)l(this).removeAttr(n[a]),l(this).removeClass(k.warringClass)})};return this.each(function(){var c=new m.CheckClass;c._initClass();if(k.onBlurCheck)l(m).find("[fccheck]").off().on("blur",function(){var a=l(this);if(a.attr("fccheck")&&0==c.halderCheck(!1,a))return!1})})}})(jQuery);